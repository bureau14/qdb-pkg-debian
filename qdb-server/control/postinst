#!/bin/sh

set -eu

USER="qdb"
GROUP="$USER"

# Database
mkdir -p /var/lib/qdb/db
chown $USER:$GROUP /var/lib/qdb/db

# Log
mkdir -p /var/log/qdb
chown $USER:$GROUP /var/log/qdbd

# Config
mkdir -p /etc/qdb
qdbd_generate_config /etc/qdb/ /var/log/qdb /var/lib/qdb/db

sysctl -e -q -p /etc/sysctl.d/30-quasardb.conf

chown root:root /usr/share/qdb/upstart/qdbd.conf

if ps -p1 | grep -q systemd; then
    ln -sf /usr/share/qdb/systemd/qdbd.service /etc/systemd/system/qdbd.service
    systemctl daemon-reload
else
    ln -sf /usr/share/qdb/upstart/qdbd.conf /etc/init/qdbd.conf
    initctl reload-configuration
fi
